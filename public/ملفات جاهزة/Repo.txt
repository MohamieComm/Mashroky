Repo

- هيكل مجلدات نهائي
- ما هو دور كل جزء
- كيف تشغّل الـ backend والـ frontend والـ SDKs

---

### 1. الهيكل العام للريبو

```bash
travel-saas/
  backend/
  frontend/
  sdk/
  README.md
```

---

### 2. مجلد backend (Node + TS + Prisma + Mongo + Travel APIs)

```bash
backend/
  package.json
  tsconfig.json
  .env
  prisma/
    schema.prisma
  src/
    lib/
      prisma.ts
    config/
      providersConfig.ts
    types/
      travel.ts
      auth.ts
    services/
      jwtService.ts
      apiKeyService.ts
      amadeusService.ts
      googleMapsService.ts
      openWeatherService.ts
      geoDbService.ts
      unifiedTravelService.ts
    repositories/
      userRepo.ts
      authRepo.ts
      apiKeyRepo.ts
      teamRepo.ts        # (اختياري: لو حاب تفصل منطق الفريق)
    middleware/
      apiKeyAuth.ts
      validate.ts
      requireRole.ts
      authGuard.ts       # (JWT guard لقراءة user من الـ token)
    routes/
      authRoutes.ts
      travelRoutes.ts
      teamApiKeyRoutes.ts
    server.ts
  openapi.yaml
  travel-api.postman_collection.json
  public/
    docs-mohamie.html
    api-keys-dashboard.html
```

#### أهم الملفات (محتواها من اللي كتبناه سابقًا):

- `prisma/schema.prisma`  
  يحتوي: `User`, `Team`, `TeamMember`, `ApiKey`, `RefreshSession`, `Role`.

- `src/lib/prisma.ts`  
  تهيئة `PrismaClient`.

- `src/config/providersConfig.ts`  
  مفاتيح Amadeus, Google Maps, OpenWeather, GeoDB من `.env`.

- `src/services/*Service.ts`  
  نفس خدمات السفر اللي بنيناها:
  - `amadeusService.ts`
  - `googleMapsService.ts`
  - `openWeatherService.ts`
  - `geoDbService.ts`
  - `unifiedTravelService.ts`
  - `jwtService.ts`
  - `apiKeyService.ts`

- `src/repositories/*.ts`  
  نفس الـ Repos اللي ربطناها بـ Prisma:
  - `userRepo.ts` (إنشاء مستخدم، إيجاد مستخدم، تدوير apiKey)
  - `authRepo.ts` (جلسات refresh)
  - `apiKeyRepo.ts` (مفاتيح الفريق المتعددة)

- `src/middleware/`  
  - `apiKeyAuth.ts` → يقرأ `X-API-Key` ويحمّل user/team.
  - `authGuard.ts` → يقرأ JWT من `Authorization: Bearer`.
  - `requireRole.ts` → يتحقق من `OWNER / ADMIN / MEMBER`.
  - `validate.ts` → Zod DTO validation.

- `src/routes/`  
  - `authRoutes.ts` → register/login/refresh/logout (JWT + Refresh + Prisma).
  - `travelRoutes.ts` → `/api/travel/search` + باقي الـ endpoints (flights/places/weather/cities).
  - `teamApiKeyRoutes.ts` → `/teams/:teamId/api-keys` (list/create/revoke).

- `server.ts`  
  يربط:
  - `app.use("/auth", authRoutes);`
  - `app.use("/api", apiKeyAuth, authGuard, travelRoutes);`
  - `app.use("/teams", apiKeyAuth, authGuard, teamMemberLoader, teamApiKeyRoutes);`
  - `app.use("/docs", swaggerUi.serve, swaggerUi.setup(openapi));`
  - `app.use("/public", express.static("public"));`

> كل الأكواد التفصيلية سبق كتبناها؛ هنا فقط ربطناها في هيكل واحد.

---

### 3. مجلد frontend (Next.js Dashboard – ثيم مشروع السفر الأزرق الداكن)

```bash
frontend/
  package.json
  next.config.mjs
  tsconfig.json
  .env.local
  app/
    layout.tsx
    page.tsx                 # صفحة رئيسية (لوحة مشروع السفر)
    dashboard/
      api-keys/
        page.tsx             # صفحة إدارة مفاتيح API (الكود اللي كتبناه)
  lib/
    authClient.ts            # استهلاك backend (login / حفظ tokens)
  styles/
    globals.css              # ألوان الأزرق الداكن / slate
```

- `app/dashboard/api-keys/page.tsx`  
  هو نفس الكومبوننت اللي كتبناه:
  - يجلب `/teams/:teamId/api-keys`
  - ينشئ مفتاح جديد
  - يلغي مفتاح
  - ثيم: خلفية `bg-slate-950`، كروت `bg-slate-900`، أزرار `bg-sky-600`.

- `lib/authClient.ts`  
  يستهلك `backend` عبر `TravelClient` (من SDK TypeScript) أو مباشرة بـ `fetch`.

---

### 4. مجلد sdk (TS / Dart / Swift)

```bash
sdk/
  ts/
    package.json
    src/
      index.ts          # يصدّر TravelClient
      travelClient.ts   # الكود اللي كتبناه (Auth + API Keys + Unified Search)
  dart/
    lib/
      travel_client.dart
  swift/
    Sources/
      TravelClient/
        TravelClient.swift
```

- `sdk/ts/src/travelClient.ts`  
  نفس الكلاس اللي كتبناه:
  - `login(email, password)` → يرجع `accessToken`, `refreshToken`, `apiKey`.
  - `unifiedSearch(...)`
  - `listTeamApiKeys(...)`
  - `createTeamApiKey(...)`
  - `revokeTeamApiKey(...)`

- `sdk/dart/lib/travel_client.dart`  
  نسخة مختصرة بنفس المنطق (HTTP + headers + Auth + API Key).

- `sdk/swift/Sources/TravelClient/TravelClient.swift`  
  نسخة iOS بنفس الفكرة.

---

### 5. أوامر التشغيل

#### backend

```bash
cd backend
npm install
npx prisma db push
npm run dev
```

#### frontend

```bash
cd frontend
npm install
npm run dev
```

#### SDK TS (لو حاب تنشره لاحقًا)

```bash
cd sdk/ts
npm install
npm run build
```

---
