# تدقيق أمني للمشروع – 2026-02-10

## المصادر
- التطبيق: `app/`
- الخادم: `flight-backend/`
- الملفات العامة: `public/` (يجب مراجعة ملفات Word هنا)

## النتائج
- مشاكل حرجة: 0
- مشاكل متوسطة: 2
- مشاكل منخفضة: 2
- تحذيرات إضافية: 1

## الأدوات المستخدمة
- `app`: 
  - `npm run lint` لفحص أخطاء Typescript/ESLint (نظيف مع ملاحظات طفيفة).
  - `npm test` نجح (1 اختبار).
- `flight-backend`: لا يوجد ملفات اختبار/فحص محددة في `package.json`.

## المشاكل

### 1) ملف عمومي يحتوي على كلمة مرور Word خام
**الأولوية:** متوسطة
- وجود ملف محمي بكلمة مرور في مجلد `public/الملفات العامة.docx` (تجزئة: `95V2Thr9qmhfB2jIdS0QKruXV6MX`).
- هذا في المجلد `public/` الذي يُنشر للعموم، لذلك قد يتمكن أي مستخدم من الوصول إليه.
**التوصيات:**
- نقله/حذفه من المجلد العام إلى مكان آمن خاص.
- تأكد من عدم رفع ملفات حساسة إلى مجلد التطبيق العام.

### 2) أسماء ملفات عربية مشوهة في `public/`
**الأولوية:** منخفضة
- ملفات Word بأسماء غريبة مشوهة في `public/`، قد يسبب مشاكل في التنزيل أو المشاركة.
- هذا لن يؤثر بالضرورة على الأمان لكن قد يخلق مشاكل في توافقية المستخدمين المختلفين.
**التوصيات:**
- إعادة تسمية الملفات باسم لاتيني بسيط.
- استخدام الأحرف الإنجليزية أو الأرقام بدلاً من العربية.

### 3) تخزين البيانات الحساسة في `localStorage`
**الأولوية:** متوسطة
- توكن المستخدم (Supabase Session) محفوظ في `localStorage` (سلوك افتراضي).
- هذا يعرض المستخدم لخطر اختراق XSS إذا تم حقن كود خبيث.
**التوصيات:**
- استخدام إعدادات Supabase المتقدمة لتعيين الجلسات.
- تقليل عمر جلسة المستخدم إلى أقصر مدة آمنة ممكنة.

### 4) إدارة مفاتيح API
**الأولوية:** متوسطة
- وجود حقول لتخزين مفاتيح API مثل `ADMIN_API_KEY` بشكل نصي.
**التوصيات:**
- تشفير المفاتيح عند التخزين بدلاً من النص الصريح.
- تقييد الوصول إلى API/نقاط النهاية من خلال IP.

### 5) ملاحظة: CSP سياسة أمان المحتوى
**الأولوية:** منخفضة
- `helmet` مُفعّل لكن `contentSecurityPolicy` مُعطّل.
**التوصيات:**
- عند نشر الإنتاج النهائي، فكّر في تفعيل CSP لمزيد من الأمان.

## نقاط إيجابية
- تفعيل `helmet` و`rateLimit` في الخادم.
- استخدام بوابة دفع آمنة (Moyasar API).

## الخطوات الموصى بها
1. نقل ملفات Word من `public/` إلى مكان خاص أو حذفها إذا لم تكن ضرورية.
2. تشفير أي مفاتيح API محفوظة في قاعدة البيانات بدلاً من النص الصريح.
3. مراجعة تدفق `lint` لتجنب أخطاء تنسيق الكود المعقدة.

