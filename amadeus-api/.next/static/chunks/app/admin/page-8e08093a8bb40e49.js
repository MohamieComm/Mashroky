(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{7708:function(e,s,t){Promise.resolve().then(t.bind(t,9725))},9725:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a=t(7437),l=t(2265),r=t(4508);function d(){let[e,s]=(0,l.useState)("overview"),[t,d]=(0,l.useState)(null),[n,i]=(0,l.useState)([]),[c,x]=(0,l.useState)([]),[o,h]=(0,l.useState)([]),[m,u]=(0,l.useState)(null),[g,p]=(0,l.useState)(!1),[b,j]=(0,l.useState)(""),y=()=>({Authorization:"Bearer ".concat(localStorage.getItem("admin_token")||""),"Content-Type":"application/json"}),N=async e=>{let s=await fetch("/api/admin/".concat(e),{headers:y()});if(!s.ok)throw Error("Failed to fetch ".concat(e));return s.json()};(0,l.useEffect)(()=>{f(e)},[e]);let f=async e=>{p(!0),j("");try{switch(e){case"overview":let s=await N("stats");d(s.data);break;case"bookings":let t=await N("bookings");i(t.data||[]);break;case"users":let a=await N("users");x(a.data||[]);break;case"logs":let l=await N("logs");h(l.data||[]);break;case"config":let r=await N("config");u(r.data||{})}}catch(e){j(e.message)}finally{p(!1)}},v=async(e,s)=>{try{await fetch("/api/admin/users",{method:"PUT",headers:y(),body:JSON.stringify({userId:e,newRole:s})}),f("users")}catch(e){j(e.message)}},w=async()=>{try{await fetch("/api/admin/config",{method:"PUT",headers:y(),body:JSON.stringify(m)}),alert("تم حفظ الإعدادات بنجاح")}catch(e){j(e.message)}},D={confirmed:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",cancelled:"bg-red-100 text-red-700",failed:"bg-gray-100 text-gray-700"},_={confirmed:"مؤكد",pending:"قيد الانتظار",cancelled:"ملغي",failed:"فشل"},k={flight:"✈️ طيران",hotel:"\uD83C\uDFE8 فندق",transfer:"\uD83D\uDE97 نقل",activity:"\uD83C\uDFAF نشاط"},C={user:"مستخدم",admin:"مشرف",super_admin:"مشرف عام"};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",dir:"rtl",children:[(0,a.jsx)("div",{className:"bg-gradient-to-l from-gray-900 to-gray-800 text-white py-6 px-4",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"\uD83D\uDEE1️ لوحة التحكم — مشروك"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"إدارة الحجوزات والمستخدمين و Amadeus API"})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,a.jsx)("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[{id:"overview",label:"نظرة عامة",icon:"\uD83D\uDCCA"},{id:"bookings",label:"الحجوزات",icon:"\uD83D\uDCCB"},{id:"users",label:"المستخدمين",icon:"\uD83D\uDC65"},{id:"logs",label:"سجل API",icon:"\uD83D\uDCDD"},{id:"config",label:"الإعدادات",icon:"⚙️"}].map(t=>(0,a.jsxs)("button",{onClick:()=>s(t.id),className:"px-5 py-2.5 rounded-lg font-medium whitespace-nowrap transition-all ".concat(e===t.id?"bg-gray-900 text-white shadow-lg":"bg-white text-gray-600 hover:bg-gray-100 shadow"),children:[t.icon," ",t.label]},t.id))}),b&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:["⚠️ ",b]}),g&&(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-gray-300 rounded-full border-t-gray-800"})}),!g&&"overview"===e&&t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"إجمالي الحجوزات"}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:t.totalBookings})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"الإيرادات"}),(0,a.jsx)("div",{className:"text-3xl font-bold text-green-700",children:(0,r.T4)(t.totalRevenue)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"المستخدمين"}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:t.totalUsers})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"استدعاءات API"}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:t.apiCalls})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"متوسط وقت الاستجابة"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[t.avgResponseTime," ms"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"نسبة الأخطاء"}),(0,a.jsxs)("div",{className:"text-2xl font-bold ".concat(t.errorRate>10?"text-red-600":"text-green-600"),children:[t.errorRate,"%"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"المشرفين"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.adminUsers})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("h3",{className:"font-bold mb-3",children:"حسب النوع"}),Object.entries(t.bookingsByType).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{children:k[s]||s}),(0,a.jsx)("span",{className:"font-bold",children:t})]},s)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-5",children:[(0,a.jsx)("h3",{className:"font-bold mb-3",children:"حسب الحالة"}),Object.entries(t.bookingsByStatus).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs ".concat(D[s]||""),children:_[s]||s}),(0,a.jsx)("span",{className:"font-bold",children:t})]},s)})]})]})]}),!g&&"bookings"===e&&(0,a.jsx)("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"رقم الحجز"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"النوع"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"المستخدم"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"المبلغ"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الحالة"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"التاريخ"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[n.map(e=>{var s,t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-mono text-xs",children:e.id.substring(0,8)}),(0,a.jsx)("td",{className:"px-4 py-3",children:k[e.booking_type]||e.booking_type}),(0,a.jsx)("td",{className:"px-4 py-3",children:(null===(s=e.profiles)||void 0===s?void 0:s.full_name)||(null===(t=e.profiles)||void 0===t?void 0:t.email)||"مجهول"}),(0,a.jsx)("td",{className:"px-4 py-3 font-bold",children:e.total_amount?(0,r.T4)(e.total_amount,e.currency):"—"}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(D[e.status]||""),children:_[e.status]||e.status})}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ar-SA")})]},e.id)}),0===n.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400",children:"لا توجد حجوزات"})})]})]})})}),!g&&"users"===e&&(0,a.jsx)("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الاسم"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"البريد"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الدور"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"تاريخ التسجيل"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"إجراء"})]})}),(0,a.jsx)("tbody",{className:"divide-y",children:c.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:e.full_name||"—"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",dir:"ltr",children:e.email}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("super_admin"===e.role?"bg-purple-100 text-purple-700":"admin"===e.role?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:C[e.role]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ar-SA")}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("select",{value:e.role,onChange:s=>v(e.id,s.target.value),className:"text-xs border rounded px-2 py-1",children:[(0,a.jsx)("option",{value:"user",children:"مستخدم"}),(0,a.jsx)("option",{value:"admin",children:"مشرف"}),(0,a.jsx)("option",{value:"super_admin",children:"مشرف عام"})]})})]},e.id))})]})})}),!g&&"logs"===e&&(0,a.jsx)("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الوقت"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الطريقة"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"النقطة"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الحالة"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"الزمن"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"خطأ"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[o.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(e.created_at).toLocaleString("ar-SA")}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-mono ".concat("GET"===e.method?"bg-green-100 text-green-700":"POST"===e.method?"bg-blue-100 text-blue-700":"DELETE"===e.method?"bg-red-100 text-red-700":"bg-gray-100"),children:e.method})}),(0,a.jsx)("td",{className:"px-4 py-3 font-mono text-xs",dir:"ltr",children:e.endpoint}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"font-mono text-xs ".concat(400>(e.response_status||0)?"text-green-600":"text-red-600"),children:e.response_status})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-xs",children:[e.response_time_ms,"ms"]}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-red-500 max-w-[200px] truncate",children:e.error_message||"—"})]},e.id)),0===o.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400",children:"لا توجد سجلات"})})]})]})})}),!g&&"config"===e&&m&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-6 space-y-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:"⚙️ إعدادات Amadeus API"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),(0,a.jsx)("input",{type:"text",value:m.client_id||"",onChange:e=>u({...m,client_id:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg font-mono",dir:"ltr"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),(0,a.jsx)("input",{type:"password",value:m.client_secret||"",onChange:e=>u({...m,client_secret:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg font-mono",dir:"ltr"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Base URL"}),(0,a.jsx)("input",{type:"url",value:m.base_url||"https://test.api.amadeus.com",onChange:e=>u({...m,base_url:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg font-mono",dir:"ltr"})]})]}),(0,a.jsx)("h4",{className:"font-bold mt-4",children:"تفعيل / تعطيل الخدمات"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[{key:"flights_enabled",label:"✈️ الرحلات"},{key:"hotels_enabled",label:"\uD83C\uDFE8 الفنادق"},{key:"transfers_enabled",label:"\uD83D\uDE97 النقل"},{key:"activities_enabled",label:"\uD83C\uDFAF الأنشطة"},{key:"analytics_enabled",label:"\uD83D\uDCCA التحليلات"}].map(e=>{let{key:s,label:t}=e;return(0,a.jsxs)("label",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:!1!==m[s],onChange:e=>u({...m,[s]:e.target.checked}),className:"rounded text-blue-600"}),(0,a.jsx)("span",{className:"text-sm",children:t})]},s)})}),(0,a.jsx)("button",{onClick:w,className:"px-8 py-3 bg-gray-900 text-white font-bold rounded-lg hover:bg-gray-800",children:"\uD83D\uDCBE حفظ الإعدادات"})]})]})]})}},4508:function(e,s,t){"use strict";function a(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SAR",t="string"==typeof e?parseFloat(e):e;return new Intl.NumberFormat("ar-SA",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:2}).format(t)}function l(e){let s=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?/);if(!s)return e;let t=s[1]?"".concat(s[1],"س"):"",a=s[2]?"".concat(s[2],"د"):"";return"".concat(t," ").concat(a).trim()}function r(e){return new Date(e).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",hour12:!1})}function d(e){return 0===e?"مباشر":1===e?"توقف واحد":2===e?"توقفان":"".concat(e," توقفات")}function n(e,s){return e.length<=s?e:e.substring(0,s)+"..."}t.d(s,{$G:function(){return n},LU:function(){return l},T4:function(){return a},iP:function(){return d},mr:function(){return r}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7708)}),_N_E=e.O()}]);